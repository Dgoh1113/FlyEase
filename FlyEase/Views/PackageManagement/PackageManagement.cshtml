@model FlyEase.Data.Package
@{
    ViewData["Title"] = "Package Management";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Head {
    <link rel="stylesheet" href="~/css/packagemanagement.css" />
}

<section class="management-hero">
    <div class="hero-content">
        <h1>Package Management</h1>
        <p>Manage your travel packages with ease</p>
    </div>
</section>

<div class="management-container">
    <!-- Success/Error Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle"></i> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle"></i> @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="management-grid">
        <!-- Package Form Section -->
        <div class="form-section">
            <div class="form-card">
                <div class="form-header">
                    <h3>
                        <i class="fas @(ViewBag.EditingId != null ? "fa-edit" : "fa-plus-circle")"></i>
                        @(ViewBag.EditingId != null ? "Edit Package" : "Create New Package")
                    </h3>
                </div>
                <div class="form-body">
                    <form method="post" action="@(ViewBag.EditingId != null ? Url.Action("Edit", "PackageManagement") : Url.Action("Create", "PackageManagement"))">
                        @Html.AntiForgeryToken()

                        @if (ViewBag.EditingId != null)
                        {
                            <input type="hidden" name="PackageID" value="@Model.PackageID" />
                        }

                        <div class="form-row">
                            <div class="form-group">
                                <label for="PackageName" class="form-label">Package Name *</label>
                                <input type="text" class="form-control" id="PackageName" name="PackageName"
                                       value="@Model.PackageName" required placeholder="Enter package name">
                                <span asp-validation-for="PackageName" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label for="CategoryID" class="form-label">Category *</label>
                                <select class="form-control" id="CategoryID" name="CategoryID" required>
                                    <option value="">Select Category</option>
                                    @foreach (var category in ViewBag.Categories)
                                    {
                                        <option value="@category.CategoryID"
                                                selected="@(Model.CategoryID == category.CategoryID)">
                                            @category.CategoryName
                                        </option>
                                    }
                                </select>
                                <span asp-validation-for="CategoryID" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="Description" class="form-label">Description</label>
                            <textarea class="form-control" id="Description" name="Description"
                                      rows="3" placeholder="Enter package description">@Model.Description</textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label for="Destination" class="form-label">Destination *</label>
                            <input type="text" class="form-control" id="Destination" name="Destination"
                                   value="@Model.Destination" required placeholder="Enter destination">
                            <span asp-validation-for="Destination" class="text-danger"></span>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="Price" class="form-label">Price (RM) *</label>
                                <input type="number" step="0.01" class="form-control" id="Price" name="Price"
                                       value="@Model.Price" required placeholder="0.00">
                                <span asp-validation-for="Price" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label for="AvailableSlots" class="form-label">Available Slots *</label>
                                <input type="number" class="form-control" id="AvailableSlots" name="AvailableSlots"
                                       value="@Model.AvailableSlots" required placeholder="0">
                                <span asp-validation-for="AvailableSlots" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="StartDate" class="form-label">Start Date *</label>
                                <input type="date" class="form-control" id="StartDate" name="StartDate"
                                       value="@(Model.StartDate.ToString("yyyy-MM-dd"))" required>
                                <span asp-validation-for="StartDate" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label for="EndDate" class="form-label">End Date *</label>
                                <input type="date" class="form-control" id="EndDate" name="EndDate"
                                       value="@(Model.EndDate.ToString("yyyy-MM-dd"))" required>
                                <span asp-validation-for="EndDate" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="ImageURL" class="form-label">Image URL</label>
                            <input type="text" class="form-control" id="ImageURL" name="ImageURL"
                                   value="@Model.ImageURL" placeholder="https://example.com/image.jpg">
                            <span asp-validation-for="ImageURL" class="text-danger"></span>
                        </div>

                        <div class="form-actions">
                            @if (ViewBag.EditingId != null)
                            {
                                <button type="submit" class="btn btn-warning">
                                    <i class="fas fa-save"></i> Update Package
                                </button>
                                <a href="@Url.Action("PackageManagement", "PackageManagement")" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> Cancel
                                </a>
                            }
                            else
                            {
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-plus"></i> Create Package
                                </button>
                            }
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Packages List Section -->
        <div class="list-section">
            <div class="list-card">
                <div class="list-header">
                    <h3><i class="fas fa-list"></i> Existing Packages</h3>
                    <span class="badge bg-primary">@ViewBag.Packages.Count</span>
                </div>
                <div class="list-body">
                    @if (ViewBag.Packages != null && ViewBag.Packages.Count > 0)
                    {
                        <div class="packages-grid">
                            @foreach (var package in ViewBag.Packages)
                            {
                                <div class="package-management-card">
                                    <div class="package-image">
                                        <img src="@(package.ImageURL ?? "https://images.unsplash.com/photo-1505761671935-60b3a7427bad")"
                                             alt="@package.PackageName" />
                                        <div class="package-actions">
                                            <a href="@Url.Action("Edit", "PackageManagement", new { id = package.PackageID })"
                                               class="btn-edit" title="Edit Package">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <form method="post" action="@Url.Action("Delete", "PackageManagement")"
                                                  onsubmit="return confirm('Are you sure you want to delete \" @package.PackageName\"?');">
                                                @Html.AntiForgeryToken()
                                                <input type="hidden" name="id" value="@package.PackageID" />
                                                <button type="submit" class="btn-delete" title="Delete Package">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="package-content">
                                        <h4>@package.PackageName</h4>
                                        <p class="package-category">
                                            <i class="fas fa-tag"></i> @package.Category?.CategoryName
                                        </p>
                                        <p class="package-destination">
                                            <i class="fas fa-map-marker-alt"></i> @package.Destination
                                        </p>
                                        <p class="package-price">RM @package.Price.ToString("N2")</p>
                                        <div class="package-details">
                                            <span class="date-range">
                                                <i class="fas fa-calendar"></i>
                                                @package.StartDate.ToString("MMM dd") - @package.EndDate.ToString("MMM dd, yyyy")
                                            </span>
                                            <span class="slots">
                                                <i class="fas fa-users"></i> @package.AvailableSlots slots
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="empty-state">
                            <i class="fas fa-box-open"></i>
                            <h4>No Packages Found</h4>
                            <p>Create your first package to get started!</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-hide alerts after 5 seconds
        setTimeout(function () {
            $('.alert').fadeOut('slow');
        }, 5000);

        // Set min date for date inputs to today
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('StartDate').min = today;
            document.getElementById('EndDate').min = today;

            // Validate end date is after start date
            const startDate = document.getElementById('StartDate');
            const endDate = document.getElementById('EndDate');

            startDate.addEventListener('change', function() {
                endDate.min = this.value;
            });
        });
    </script>
}