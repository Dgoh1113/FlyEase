@model FlyEase.ViewModels.UsersManagementVM
@{
    ViewData["Title"] = "Manage Users";
    Layout = "~/Views/Shared/_StaffLayout.cshtml"; // <--- CHANGE THIS
}

<div class="container mt-4">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <h2>User Management</h2>

    <div class="card shadow-sm mt-3">
        <div class="card-body p-0">
            <table class="table table-hover mb-0 align-middle">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email / Phone</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var u in Model.Users)
                    {
                        <tr>
                            <td>@u.UserID</td>
                            <td>@u.FullName</td>
                            <td>
                                @u.Email<br />
                                <small class="text-muted">@u.Phone</small>
                            </td>
                            <td>
                                <span class="badge @(u.Role == "Admin" ? "bg-danger" : u.Role == "Staff" ? "bg-info" : "bg-secondary")">
                                    @u.Role
                                </span>
                            </td>
                            <td>
                                <button type="button" class="btn btn-sm btn-primary"
                                        onclick="openEditModal(@u.UserID, '@u.FullName', '@u.Email', '@u.Phone', '@u.Role')">
                                    Edit
                                </button>

                                <form asp-action="DeleteUser" asp-route-id="@u.UserID" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this user?');">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="editUserModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Edit User</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <form asp-action="UpdateUser" method="post">
                <div class="modal-body">
                    <input type="hidden" id="modalUserID" asp-for="CurrentUser.UserID" />

                    <div class="mb-3">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="modalFullName" asp-for="CurrentUser.FullName" class="form-control" required />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" id="modalEmail" asp-for="CurrentUser.Email" class="form-control" required />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="text" id="modalPhone" asp-for="CurrentUser.Phone" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Role</label>
                        <select id="modalRole" asp-for="CurrentUser.Role" class="form-select">
                            <option value="User">User</option>
                            <option value="Staff">Staff</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function openEditModal(id, name, email, phone, role) {
        // 1. Fill the input fields in the modal with data from the row
        document.getElementById('modalUserID').value = id;
        document.getElementById('modalFullName').value = name;
        document.getElementById('modalEmail').value = email;
        document.getElementById('modalPhone').value = phone;
        document.getElementById('modalRole').value = role;

        // 2. Show the modal using Bootstrap API
        var myModal = new bootstrap.Modal(document.getElementById('editUserModal'));
        myModal.show();
    }
</script>