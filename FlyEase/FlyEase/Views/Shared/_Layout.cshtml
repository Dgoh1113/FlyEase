@using Microsoft.AspNetCore.Mvc.Localization
@inject IHtmlLocalizer<FlyEase.SharedResource> Localizer

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - FlyEase Travel</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="~/css/_layout.css?v=4" />
    <link rel="stylesheet" href="~/css/site.css" />

    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme');
            const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
                document.documentElement.setAttribute('data-bs-theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-bs-theme', 'light');
            }
        })();
    </script>

    <style>
        .icon-svg {
            width: 1.2em;
            height: 1.2em;
            fill: currentColor;
            vertical-align: text-bottom;
        }

        .icon-lg {
            width: 1.5em;
            height: 1.5em;
        }
    </style>

    @RenderSection("Head", required: false)
</head>
<body>
    <header class="fixed-top">
        <div class="container-fluid d-flex align-items-center">

            <button class="btn-hamburger" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-label="Toggle navigation">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon-svg icon-lg" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
                </svg>
            </button>

            <a class="navbar-brand fw-bold m-0 flyease-brand" asp-controller="Home" asp-action="Index">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon-svg me-2" viewBox="0 0 16 16">
                    <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z" />
                </svg>
                FlyEase
            </a>

            <div class="ms-auto">
                @if (User.Identity != null && User.Identity.IsAuthenticated)
                {
                    <div class="dropdown">
                        <button class="btn btn-link text-decoration-none dropdown-toggle d-flex align-items-center text-body" type="button" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="me-2 d-none d-md-inline fw-bold small">@User.Identity.Name</span>
                            <i class="fas fa-user-circle fs-4"></i>
                        </button>

                        <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2" aria-labelledby="navbarDropdown">
                            <li>
                                <a class="dropdown-item" asp-controller="Auth" asp-action="Profile">
                                    <i class="fas fa-user-circle me-2"></i> My Profile
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" asp-controller="Feedback" asp-action="Insights">
                                    <i class="fas fa-chart-line me-2 text-primary"></i> Travel Insights
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form asp-controller="Auth" asp-action="Logout" method="post">
                                    <button type="submit" class="dropdown-item text-danger">Logout</button>
                                </form>
                            </li>
                        </ul>
                    </div>
                }
                else
                {
                    <div class="d-flex gap-2">
                        <a asp-controller="Auth" asp-action="Login" class="btn btn-outline-primary btn-sm rounded-pill px-3 fw-bold">Login</a>
                        <a asp-controller="Auth" asp-action="Register" class="btn btn-primary btn-sm rounded-pill px-3 fw-bold">Register</a>
                    </div>
                }
            </div>

        </div>
    </header>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title fw-bold text-primary" id="sidebarMenuLabel">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon-svg me-2" viewBox="0 0 16 16">
                    <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z" />
                </svg>
                Menu
            </h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>

        <div class="offcanvas-body d-flex flex-column p-0">
            <div class="list-group list-group-flush">
                <a class="list-group-item list-group-item-action" asp-controller="Home" asp-action="Index">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-svg me-3 text-muted" viewBox="0 0 16 16"><path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z" /></svg>
                    @Localizer["Home"]
                </a>
                <a class="list-group-item list-group-item-action" asp-controller="Home" asp-action="Packages">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-svg me-3 text-muted" viewBox="0 0 16 16"><path d="M3 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H3zm9 2v12H4V2h8zm-2 3H6v2h4V5z" /></svg>
                    @Localizer["Packages"]
                </a>
                <a class="list-group-item list-group-item-action" asp-controller="Discount" asp-action="Discounts">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-svg me-3 text-muted" viewBox="0 0 16 16"><path d="M3 2v4.586l7 7L14.586 9l-7-7H3zM2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586V2z" /><path d="M5.5 5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z" /></svg>
                    @Localizer["Discounts"]
                </a>
                <a class="list-group-item list-group-item-action" asp-controller="Contact" asp-action="Index">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-svg me-3 text-muted" viewBox="0 0 16 16"><path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z" /></svg>
                    @Localizer["Contact"]
                </a>

                @if (User.IsInRole("Staff") || User.IsInRole("Admin"))
                {
                    <a class="list-group-item list-group-item-action text-warning fw-bold" asp-controller="PackageManagement" asp-action="PackageManagement">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-svg me-3" viewBox="0 0 16 16"><path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z" /><path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z" /></svg>
                        @Localizer["ManagePackages"]
                    </a>
                }
            </div>

            <div class="sidebar-footer">

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span class="small text-muted fw-bold text-uppercase">Appearance</span>
                    <button class="btn btn-sm btn-outline-secondary rounded-pill px-3" id="themeToggle" onclick="toggleTheme()">
                        <svg xmlns="http://www.w3.org/2000/svg" id="themeIcon" class="icon-svg me-1" viewBox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z" /></svg>
                        Mode
                    </button>
                </div>

                <div class="dropdown mb-3">
                    <button class="btn btn-outline-primary w-100 dropdown-toggle text-start d-flex align-items-center justify-content-between" type="button" id="langDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon-svg me-2" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z" /></svg>
                            Language
                        </span>
                    </button>
                    <ul class="dropdown-menu w-100 shadow border-0">
                        <li><a class="dropdown-item d-flex align-items-center" asp-controller="Language" asp-action="SetLanguage" asp-route-culture="en" asp-route-returnUrl="@Context.Request.Path"><img src="https://flagcdn.com/w20/us.png" class="me-3"> English (EN)</a></li>
                        <li><a class="dropdown-item d-flex align-items-center" asp-controller="Language" asp-action="SetLanguage" asp-route-culture="ms" asp-route-returnUrl="@Context.Request.Path"><img src="https://flagcdn.com/w20/my.png" class="me-3"> Bahasa Melayu</a></li>
                        <li><a class="dropdown-item d-flex align-items-center" asp-controller="Language" asp-action="SetLanguage" asp-route-culture="zh-CN" asp-route-returnUrl="@Context.Request.Path"><img src="https://flagcdn.com/w20/cn.png" class="me-3"> 中文 (CN)</a></li>
                    </ul>
                </div>

            </div>
        </div>
    </div>

    <main>
        @RenderBody()
    </main>

    <footer class="mt-5">
        <div class="container">
            <p class="text-muted small mb-0">© 2025 FlyEase Travel. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <partial name="_Chatbot" />

    @await RenderSectionAsync("Scripts", required: false)

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-bs-theme');
            updateIcon(currentTheme);
        });

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-bs-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateIcon(newTheme);
        }

        function updateIcon(theme) {
            // Icon logic
        }
    </script>
</body>
</html>